# Основные концепции Flowaxy CMS

## Введение

Flowaxy CMS построена на нескольких ключевых концепциях, которые определяют архитектуру и принципы работы системы.

## 1. Модульность

Система разделена на независимые модули, каждый из которых отвечает за свою область функциональности.

### Преимущества:
- Легкая замена компонентов
- Простое тестирование
- Переиспользование кода
- Масштабируемость

## 2. Singleton Pattern

Критически важные сервисы реализованы как Singleton для обеспечения единственного экземпляра:

- `Database::getInstance()`
- `Cache::getInstance()`
- `Logger::getInstance()`
- `Config::getInstance()`

### Причины использования:
- Единая точка доступа к ресурсам
- Контроль над инициализацией
- Экономия памяти

## 3. Dependency Injection через хелперы

Вместо прямого создания объектов используются глобальные функции-хелперы:

```php
$db = database();        // Database::getInstance()
$cache = cache();       // Cache::getInstance()
$logger = logger();     // Logger::getInstance()
```

### Преимущества:
- Упрощенный доступ
- Единообразие API
- Легкое тестирование

## 4. Система хуков

Хуки позволяют плагинам и темам интегрироваться с системой без модификации ядра.

### Типы хуков:

#### Фильтры (Filters)
Модифицируют данные перед их использованием:

```php
$content = applyFilter('content', $content);
```

#### События (Actions)
Выполняют действия в определенные моменты:

```php
doAction('before_save_post', $post);
```

### Регистрация хуков:

```php
addHook('hook_name', function($data) {
    // Обработка
    return $data;
}, 10); // Приоритет
```

## 5. Ленивая загрузка (Lazy Loading)

Компоненты загружаются только когда они действительно нужны:

- Модули загружаются по требованию
- Настройки загружаются при первом обращении
- Плагины активируются только при необходимости

### Преимущества:
- Быстрая инициализация
- Экономия памяти
- Оптимизация производительности

## 6. Хранилища (Storage)

Единый интерфейс для работы с различными типами хранилищ:

- `CookieManager` - cookies
- `SessionManager` - сессии
- `StorageManager` - localStorage/sessionStorage (клиент)

### Преимущества:
- Единый API
- Легкое переключение между типами
- Абстракция от реализации

## 7. Безопасность из коробки

Все компоненты системы разработаны с учетом безопасности:

- **Prepared Statements** - защита от SQL injection
- **htmlspecialchars** - защита от XSS
- **CSRF токены** - защита от CSRF атак
- **Security Headers** - дополнительные заголовки безопасности
- **Валидация данных** - проверка всех входных данных

## 8. Кеширование

Многоуровневая система кеширования:

1. **Память** - кеш для текущего запроса
2. **Файлы** - персистентный кеш
3. **БД** - кеш в базе данных (опционально)

### Стратегии:
- TTL (Time To Live) - время жизни кеша
- Тегирование - группировка кеша
- Автоматическая очистка - удаление устаревших записей

## 9. Логирование

Централизованная система логирования с:

- Различными уровнями (DEBUG, INFO, WARNING, ERROR, CRITICAL)
- Ротацией файлов
- Фильтрацией по уровням и типам
- Контекстной информацией

## 10. Расширяемость

Система легко расширяется через:

- **Плагины** - функциональные расширения
- **Темы** - визуальное оформление
- **Хуки** - точки интеграции
- **API** - внешние интеграции

## 11. Типизация

Строгая типизация PHP 8.4:

- Type hints для параметров
- Return types для методов
- Property types для свойств
- `declare(strict_types=1)` во всех файлах

### Преимущества:
- Раннее обнаружение ошибок
- Лучшая поддержка IDE
- Самодокументируемый код

## 12. Обработка ошибок

Централизованная обработка ошибок:

- Глобальный обработчик ошибок
- Логирование всех ошибок
- Пользовательские страницы ошибок (404, 500)
- Graceful degradation

## Заключение

Эти концепции работают вместе, создавая гибкую, безопасную и производительную систему, которая легко расширяется и поддерживается.

