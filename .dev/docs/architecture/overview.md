# Обзор архитектуры Flowaxy CMS

## Введение

Flowaxy CMS построена на принципах модульной архитектуры с четким разделением ответственности. Система спроектирована для максимальной гибкости и расширяемости.

## Основные принципы

### 1. Модульность
Каждый компонент системы является независимым модулем, который можно легко заменить или расширить.

### 2. Единая точка входа
Все запросы проходят через единую точку входа (`index.php`), что обеспечивает централизованную обработку.

### 3. Автозагрузка классов
Система использует оптимизированный автозагрузчик классов с кешированием мапы классов.

### 4. Dependency Injection
Менеджеры и сервисы доступны через глобальные функции-хелперы, что упрощает доступ к функциональности.

## Архитектурные слои

### 1. Слой инициализации
- `index.php` - точка входа
- `engine/flowaxy.php` - автозагрузчик и константы
- `engine/init.php` - инициализация системы

### 2. Слой маршрутизации
- `Router` - базовый роутер
- `RouterManager` - менеджер роутинга с определением контекста
- `ApiHandler` - обработка API запросов

### 3. Слой обработки запросов
- `Request` - обработка HTTP запросов
- `Response` - формирование ответов
- `AjaxHandler` - обработка AJAX запросов

### 4. Слой данных
- `Database` - абстракция базы данных
- `Cache` - система кеширования
- `Config` - управление конфигурацией
- `Logger` - логирование

### 5. Слой безопасности
- `Security` - основные функции безопасности
- `Hash` - хеширование паролей
- `Encryption` - шифрование данных
- `Session` - управление сессиями

### 6. Слой менеджеров
- `PluginManager` - управление плагинами
- `ThemeManager` - управление темами
- `SettingsManager` - управление настройками
- `RoleManager` - управление ролями
- И другие менеджеры...

### 7. Слой представления
- `View` - шаблонизация
- `SimpleTemplate` - упрощенный шаблонизатор
- Административная панель (`engine/skins/`)

## Паттерны проектирования

### Singleton
Используется для менеджеров и сервисов:
- `Database::getInstance()`
- `Logger::getInstance()`
- `Cache::getInstance()`

### Factory
- `StorageFactory` - создание менеджеров хранилища

### Observer
- Система хуков (`HookManager`) - подписка на события

### Strategy
- Различные стратегии хранения (Cookie, Session, Storage)

## Жизненный цикл запроса

1. **Входная точка** (`index.php`)
   - Проверка существования файлов
   - Загрузка автозагрузчика

2. **Инициализация** (`engine/init.php`)
   - Загрузка конфигурации
   - Инициализация подключения к БД
   - Настройка обработчиков ошибок

3. **Маршрутизация** (`RouterManager`)
   - Определение контекста (admin/frontend/api)
   - Выбор соответствующего роутера

4. **Обработка запроса**
   - Валидация данных
   - Проверка прав доступа
   - Выполнение логики

5. **Формирование ответа**
   - Рендеринг шаблона
   - Отправка HTTP заголовков
   - Вывод контента

## Расширяемость

Система расширяется через:
- **Плагины** - функциональные расширения
- **Темы** - визуальное оформление
- **Хуки** - точки интеграции
- **API** - внешние интеграции

## Производительность

- Ленивая загрузка компонентов
- Кеширование на нескольких уровнях
- Оптимизированные запросы к БД
- Минимизация использования памяти

## Безопасность

- Защита от SQL injection (prepared statements)
- Защита от XSS (htmlspecialchars)
- CSRF токены
- Security Headers
- Система ролей и прав доступа

