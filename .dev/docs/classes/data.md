# Классы для работы с данными

Классы для работы с базой данных, кешированием, логированием и конфигурацией.

## Database

Класс для работы с базой данных через PDO.

### Описание
`Database` предоставляет абстракцию для работы с базой данных MySQL/MariaDB через PDO с защитой от SQL-инъекций, логированием запросов и статистикой.

### Расположение
`engine/classes/data/Database.php`

### Основные методы

#### `getInstance(): self`
Получение экземпляра класса (Singleton).

#### `getConnection(): ?PDO`
Получение подключения к базе данных.

#### `query(string $sql, array $params = []): PDOStatement`
Выполнение SQL запроса с подготовленными параметрами.

**Параметры:**
- `$sql` - SQL запрос
- `$params` - параметры запроса

**Пример:**
```php
$db = Database::getInstance();
$stmt = $db->query("SELECT * FROM users WHERE id = ?", [1]);
$user = $stmt->fetch();
```

#### `getStats(): array`
Получение статистики запросов.

**Возвращает:**
```php
[
    'total_queries' => 10,
    'total_time' => 0.05,
    'slow_queries' => 2,
    'errors' => 0
]
```

### Особенности

- Автоматическое логирование медленных запросов
- Логирование ошибок БД
- Защита от SQL-инъекций через prepared statements
- Статистика выполнения запросов

---

## Cache

Система кеширования с поддержкой TTL и автоматической очисткой.

### Описание
`Cache` предоставляет многоуровневое кеширование: в памяти (для текущего запроса) и в файлах (для персистентного хранения).

### Расположение
`engine/classes/data/Cache.php`

### Основные методы

#### `getInstance(): self`
Получение экземпляра класса (Singleton).

#### `get(string $key, $default = null)`
Получение значения из кеша.

**Параметры:**
- `$key` - ключ кеша
- `$default` - значение по умолчанию

**Пример:**
```php
$cache = Cache::getInstance();
$data = $cache->get('user_123', null);
```

#### `set(string $key, $value, int $ttl = null): bool`
Сохранение значения в кеш.

**Параметры:**
- `$key` - ключ кеша
- `$value` - значение для сохранения
- `$ttl` - время жизни в секундах (по умолчанию из настроек)

**Пример:**
```php
$cache = Cache::getInstance();
$cache->set('user_123', $userData, 3600); // Кеш на 1 час
```

#### `delete(string $key): bool`
Удаление значения из кеша.

#### `clear(): bool`
Очистка всего кеша.

#### `getStats(): array`
Получение статистики кеша.

### Особенности

- Кеш в памяти для текущего запроса
- Файловый кеш для персистентного хранения
- Автоматическая очистка устаревших записей
- Настраиваемый TTL

---

## Logger

Централизованная система логирования.

### Описание
`Logger` предоставляет систему логирования с различными уровнями, ротацией файлов и фильтрацией.

### Расположение
`engine/classes/data/Logger.php`

### Уровни логирования

```php
Logger::LEVEL_DEBUG    // 0 - Отладочная информация
Logger::LEVEL_INFO     // 1 - Информационные сообщения
Logger::LEVEL_WARNING  // 2 - Предупреждения
Logger::LEVEL_ERROR    // 3 - Ошибки
Logger::LEVEL_CRITICAL // 4 - Критические ошибки
```

### Основные методы

#### `getInstance(): self`
Получение экземпляра класса (Singleton).

#### `log(int $level, string $message, array $context = []): void`
Логирование сообщения.

**Параметры:**
- `$level` - уровень логирования
- `$message` - сообщение
- `$context` - контекстные данные

**Пример:**
```php
$logger = Logger::getInstance();
$logger->log(Logger::LEVEL_ERROR, 'Ошибка подключения', [
    'host' => 'localhost',
    'port' => 3306
]);
```

#### `logDebug(string $message, array $context = []): void`
Логирование отладочного сообщения.

#### `logInfo(string $message, array $context = []): void`
Логирование информационного сообщения.

#### `logWarning(string $message, array $context = []): void`
Логирование предупреждения.

#### `logError(string $message, array $context = []): void`
Логирование ошибки.

#### `logCritical(string $message, array $context = []): void`
Логирование критической ошибки.

### Настройки логирования

- **Уровни логирования** - множественный выбор (DEBUG, INFO, WARNING, ERROR, CRITICAL)
- **Типы логирования** - множественный выбор (file, error_log, db_queries, db_errors, slow_queries)
- **Ротация** - по размеру, по времени, или оба
- **Максимальный размер файла** - настраивается в байтах
- **Время ротации** - в часах или днях
- **Хранение логов** - количество дней

### Особенности

- Ротация логов по размеру и времени
- Фильтрация по уровням и типам
- Контекстная информация в логах
- Экспорт логов (TXT, CSV, JSON)

---

## Config

Управление конфигурацией системы.

### Описание
`Config` предоставляет централизованное управление настройками системы с поддержкой вложенных ключей.

### Расположение
`engine/classes/data/Config.php`

### Основные методы

#### `get(string $key, $default = null)`
Получение значения конфигурации.

**Параметры:**
- `$key` - ключ конфигурации (поддерживает точечную нотацию: `database.host`)
- `$default` - значение по умолчанию

**Пример:**
```php
$config = new Config();
$dbHost = $config->get('database.host', 'localhost');
```

#### `set(string $key, $value): void`
Установка значения конфигурации.

#### `has(string $key): bool`
Проверка наличия ключа конфигурации.

#### `remove(string $key): void`
Удаление ключа конфигурации.

### Особенности

- Поддержка вложенных ключей через точечную нотацию
- Хранение в файле или базе данных
- Кеширование значений

---

## SystemConfig

Системная конфигурация с настройками по умолчанию.

### Описание
`SystemConfig` предоставляет доступ к системным настройкам с предустановленными значениями.

### Расположение
`engine/classes/data/SystemConfig.php`

### Основные методы

#### `getInstance(): self`
Получение экземпляра класса (Singleton).

#### `getPasswordMinLength(): int`
Минимальная длина пароля (по умолчанию 8).

#### `getDbMaxAttempts(): int`
Максимальное количество попыток подключения к БД (по умолчанию 3).

#### `getDbConnectionTimeout(): int`
Таймаут подключения к БД в секундах (по умолчанию 3).

#### `getDbSlowQueryThreshold(): float`
Порог медленных запросов в секундах (по умолчанию 1.0).

### Особенности

- Singleton паттерн
- Предустановленные значения
- Возможность переопределения через настройки

